rules_version = '2';

service cloud.firestore {
  match /databases/{database}/documents {
    // Waitlist collection - allow reads/writes with valid data structure
    // Note: This is accessed via REST API from server-side code
    match /waitlist/{emailId} {
      // Allow reads (needed for duplicate checking)
      allow read: if true;

      // Allow writes with valid data structure (name, age, city, state are optional)
      allow create, update: if
        request.resource.data.email is string &&
        (request.resource.data.name is string || request.resource.data.name == null) &&
        (request.resource.data.age is string || request.resource.data.age == null) &&
        (request.resource.data.city is string || request.resource.data.city == null) &&
        (request.resource.data.state is string || request.resource.data.state == null);
    }

    // Deny everything else by default
    match /{document=**} {
      allow read, write: if false;
    }
  }
}
